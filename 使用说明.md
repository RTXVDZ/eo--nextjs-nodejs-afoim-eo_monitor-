# EdgeOne 监控大屏 Next.js 版本使用说明

## 📋 项目概述

这是一个基于 Next.js 的腾讯云 EdgeOne 实时监控大屏，用于可视化展示站点流量、带宽、请求数等关键指标。

## 🚀 快速开始

### 1. 环境准备

确保已安装：
- Node.js 18+ 
- npm 或 yarn

### 2. 安装依赖

```bash
# 进入项目目录
cd eo_monitor-main

# 安装依赖
npm install
```

### 3. 配置腾讯云密钥

**方式一：环境变量（推荐）**

创建 `.env.local` 文件：
```env
SECRET_ID=你的腾讯云SecretId
SECRET_KEY=你的腾讯云SecretKey
SITE_NAME=我的EdgeOne监控大屏
SITE_ICON=https://example.com/favicon.ico
```

**方式二：key.txt 文件**

在项目根目录创建 `key.txt`：
```text
SecretId：你的腾讯云SecretId
SecretKey：你的腾讯云SecretKey
```

### 4. 启动项目

```bash
# 开发模式
npm run dev

# 访问 http://localhost:3000
```

## 🔧 详细配置

### 腾讯云密钥权限

确保密钥拥有 **EdgeOne 只读访问权限** (`QcloudTEOReadOnlyaccess`)。

获取密钥位置：
- **国内版**：https://console.cloud.tencent.com/cam/user/userType
- **海外版**：https://console.tencentcloud.com/cam/user/userType

### 环境变量说明

| 变量名 | 必填 | 默认值 | 说明 |
|--------|------|--------|------|
| SECRET_ID | 是 | - | 腾讯云 SecretId |
| SECRET_KEY | 是 | - | 腾讯云 SecretKey |
| SITE_NAME | 否 | AcoFork 的 EdgeOne 监控大屏 | 网站标题 |
| SITE_ICON | 否 | 默认图标 | 网站 favicon |

## 📊 功能使用指南

### 1. 时间范围控制

- **预设范围**：30分钟、1小时、6小时、今日、昨日、3天、7天、14天、31天
- **自定义范围**：可输入天、小时、分钟、秒的组合
- **数据粒度**：自动、1分钟、5分钟、1小时、1天

### 2. 站点选择

- 自动加载所有 EdgeOne 站点
- 支持选择特定站点监控
- 默认显示所有站点汇总数据

### 3. 监控面板说明

#### 流量分析 (Traffic)
- 总流量：站点访问总流量
- 请求流量：客户端到 EdgeOne 的流量
- 响应流量：EdgeOne 到客户端的流量

#### 带宽分析 (Bandwidth)
- 总带宽峰值：访问总带宽峰值
- 请求带宽峰值：客户端请求带宽峰值
- 响应带宽峰值：EdgeOne 响应带宽峰值

#### 回源分析 (Origin Pull)
- 回源请求流量：EdgeOne 节点到源站的流量
- 回源响应流量：源站到 EdgeOne 节点的流量
- 缓存命中率：1 - (源站响应 / EdgeOne 响应)

#### 边缘函数 (Edge Functions)
- 总请求数：Edge Functions 调用次数
- 总 CPU 时间：Edge Functions CPU 耗时

#### Pages 统计
- 构建次数：当日/当月 Pages 构建次数
- Cloud Functions：24小时/当月请求数和资源使用量

#### 请求与性能
- 总请求数：L7 访问总请求数
- 响应耗时：平均响应耗时和首字节耗时

#### 安全分析
- 防护命中次数：DDoS/CC 防护拦截次数

#### TOP 分析
- 全球请求分布：世界地图可视化
- 国家/地区排行：流量来源排行

## 🚢 部署指南

### 本地生产部署

```bash
# 构建项目
npm run build

# 启动生产服务器
npm start

# 访问 http://localhost:3000
```

### Vercel 部署（推荐）

1. Fork 项目到 GitHub
2. 在 Vercel 导入项目
3. 配置环境变量
4. 自动部署

### Docker 部署

```dockerfile
FROM node:18-alpine
WORKDIR /app
COPY package*.json ./
RUN npm install
COPY . .
RUN npm run build
EXPOSE 3000
CMD ["npm", "start"]
```

## 🔍 故障排除

### 常见问题

#### 1. API 返回 500 错误
```bash
# 检查密钥配置
echo $SECRET_ID
echo $SECRET_KEY

# 或检查 key.txt
cat key.txt
```

#### 2. 图表不显示
- 检查网络连接
- 确认浏览器支持 JavaScript
- 查看控制台错误信息

#### 3. 数据不更新
- 检查时间范围设置
- 确认站点选择正确
- 刷新页面重新加载

#### 4. 内存不足
```bash
# 增加 Node.js 内存限制
NODE_OPTIONS=--max-old-space-size=4096 npm run build
```

### 日志查看

```bash
# 开发模式日志
npm run dev 2>&1 | tee dev.log

# 生产模式日志
npm start 2>&1 | tee prod.log
```

## 📈 性能优化

### 开发优化
```bash
# 使用 TurboPack 加速开发
npm run dev --turbo

# 清理缓存
rm -rf .next
```

### 构建优化
```bash
# 分析构建大小
npm run build --analyze

# 仅构建必要页面
# 在 next.config.ts 中配置输出 standalone
```

## 🔄 数据更新机制

### 自动刷新
- 页面加载时自动获取最新数据
- 切换时间范围或站点时自动刷新
- 支持手动刷新按钮

### 数据缓存
- API 响应缓存 60 秒
- 图表数据本地缓存
- 减少重复 API 调用

## 📱 移动端支持

- 响应式设计，支持手机和平板
- 触摸友好的图表交互
- 适配不同屏幕尺寸

## 🔐 安全建议

1. **密钥安全**
   - 不要将密钥提交到版本控制
   - 使用环境变量或密钥管理服务
   - 定期轮换密钥

2. **访问控制**
   - 建议部署在私有网络
   - 添加身份验证层
   - 限制访问 IP

3. **数据保护**
   - 监控数据不包含敏感信息
   - API 仅返回聚合数据
   - 遵循最小权限原则

## 📞 技术支持

### 问题反馈
1. 查看控制台错误信息
2. 检查网络请求状态
3. 查看服务器日志

### 资源链接
- [腾讯云 EdgeOne 文档](https://cloud.tencent.com/document/product/1552)
- [Next.js 文档](https://nextjs.org/docs)
- [项目 GitHub](https://github.com/afoim/eo_monitior)

## 📄 版本历史

### v1.0.0 (Next.js 版本)
- 从 Express 迁移到 Next.js
- 完整的 TypeScript 支持
- 组件化架构
- 保持所有原有功能

### 后续计划
- [ ] 实时数据推送
- [ ] 多站点对比
- [ ] 自定义报警规则
- [ ] 数据导出功能

---

**注意**：本监控大屏仅用于展示 EdgeOne 监控数据，不存储任何用户敏感信息。请合理使用腾讯云 API 调用配额。